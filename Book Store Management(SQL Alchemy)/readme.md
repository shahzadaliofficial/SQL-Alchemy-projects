### **Project: "Bookstore Management System"**

Building a simple Bookstore Management System using SQLAlchemy. This project will involve designing and managing multiple relationships, performing various queries, and implementing CRUD operations. Here's the outline:

---

### **Project Description**

A bookstore needs a database to manage:

1. **Books**: Information about books, such as title, author, genre, and price.
2. **Authors**: Details of authors who write the books.
3. **Customers**: Details of customers who purchase books.
4. **Orders**: Information about book orders, including which customer placed the order, the books in the order, and the total amount.

---

### **Entities and Relationships**

1. **Tables**:

   * `Authors`: Information about authors.
   * `Books`: Details about books.
   * `Customers`: Customer details.
   * `Orders`: Orders placed by customers.
   * `OrderItems`: Mapping table for many-to-many relationship between `Orders` and `Books`.

2. **Relationships**:

   * An author can write many books (One-to-Many).
   * A book can appear in many orders, and an order can include many books (Many-to-Many).
   * A customer can place many orders (One-to-Many).

---

### **Database Schema**

#### Tables:

1. **Authors**:

   * `id` (Primary Key)
   * `name` (String)
   * `country` (String)

2. **Books**:

   * `id` (Primary Key)
   * `title` (String)
   * `author_id` (Foreign Key -> `Authors.id`)
   * `genre` (String)
   * `price` (Float)

3. **Customers**:

   * `id` (Primary Key)
   * `name` (String)
   * `email` (String)

4. **Orders**:

   * `id` (Primary Key)
   * `customer_id` (Foreign Key -> `Customers.id`)
   * `date` (DateTime)
   * `total_amount` (Float)

5. **OrderItems**:

   * `id` (Primary Key)
   * `order_id` (Foreign Key -> `Orders.id`)
   * `book_id` (Foreign Key -> `Books.id`)
   * `quantity` (Integer)

---

### **Sample Queries**

1. Add a new author and their books.
2. Retrieve all books by a specific author.
3. Find customers who ordered a specific book.
4. Calculate the total revenue generated by a particular book.
5. List all orders placed by a customer along with the books in each order.
6. Find the most popular book (by order count).

---

### **Starter Code**

```python
from sqlalchemy import create_engine, Column, Integer, String, Float, ForeignKey, DateTime, Table
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker, relationship
import datetime

# Initialize database
Base = declarative_base()
engine = create_engine("sqlite:///:memory:")
Session = sessionmaker(bind=engine)
session = Session()

# Association table for Many-to-Many (OrderItems)
class OrderItem(Base):
    __tablename__ = 'order_items'
    id = Column(Integer, primary_key=True)
    order_id = Column(Integer, ForeignKey('orders.id'))
    book_id = Column(Integer, ForeignKey('books.id'))
    quantity = Column(Integer)

# Define tables
class Author(Base):
    __tablename__ = 'authors'
    id = Column(Integer, primary_key=True)
    name = Column(String)
    country = Column(String)
    books = relationship("Book", back_populates="author")

class Book(Base):
    __tablename__ = 'books'
    id = Column(Integer, primary_key=True)
    title = Column(String)
    author_id = Column(Integer, ForeignKey('authors.id'))
    genre = Column(String)
    price = Column(Float)
    author = relationship("Author", back_populates="books")
    orders = relationship("Order", secondary="order_items", back_populates="books")

class Customer(Base):
    __tablename__ = 'customers'
    id = Column(Integer, primary_key=True)
    name = Column(String)
    email = Column(String)
    orders = relationship("Order", back_populates="customer")

class Order(Base):
    __tablename__ = 'orders'
    id = Column(Integer, primary_key=True)
    customer_id = Column(Integer, ForeignKey('customers.id'))
    date = Column(DateTime, default=datetime.datetime.utcnow)
    total_amount = Column(Float)
    customer = relationship("Customer", back_populates="orders")
    books = relationship("Book", secondary="order_items", back_populates="orders")

# Create tables
Base.metadata.create_all(engine)

# Add sample data
author1 = Author(name="J.K. Rowling", country="UK")
author2 = Author(name="George R.R. Martin", country="USA")
book1 = Book(title="Harry Potter", genre="Fantasy", price=20.0, author=author1)
book2 = Book(title="Game of Thrones", genre="Fantasy", price=25.0, author=author2)
customer1 = Customer(name="John Doe", email="john@example.com")
customer2 = Customer(name="Jane Smith", email="jane@example.com")
order1 = Order(customer=customer1, total_amount=45.0, books=[book1, book2])

session.add_all([author1, author2, book1, book2, customer1, customer2, order1])
session.commit()

# Example query: Find all books by J.K. Rowling
books_by_rowling = session.query(Book).join(Author).filter(Author.name == "J.K. Rowling").all()
for book in books_by_rowling:
    print(f"{book.title} - {book.genre}")

# Example query: Find all orders by a customer
orders_by_john = session.query(Order).join(Customer).filter(Customer.name == "John Doe").all()
for order in orders_by_john:
    print(f"Order {order.id} - Total: ${order.total_amount}")

# Close session
session.close()
```

---

### **Extensions**

1. Add more data validation (e.g., constraints on email format, non-negative prices).
2. Create a Flask or FastAPI app for a simple UI.
3. Write unit tests for each query and operation.
4. Add reporting features, such as:

   * Total sales by genre.
   * Most popular author.
   * Monthly revenue trends.

This project will provide hands-on experience with many SQLAlchemy concepts, including relationships, queries, and database management.
